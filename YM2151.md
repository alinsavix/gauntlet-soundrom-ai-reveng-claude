# Yama YM2151

## Function

The YM5151 is an FM-type sound generator equipped with an 8-bit bus line and capable of producing superb audio quality via a microprocessor program. This unit is also equipped with noise, vibrato, and amplitude modulation circuit, a sound effects circuit, and timer.

## Summary of principles of FM-type sound generation

$$E(t) = A(t) * sin[(Nc + Dc) * wt + B(t) * sin(Nm + Dm) * wt]$$

* A(t): Volume envelope
* B(t): Timbre envelope
* Nx: 1/2 of the basic pitch or multiple value
* Dx: 1/2 of the basic pitch (1.6 cents) harmonic value

For example, when B(t) = 0, you get a sine wave of (Nc + Dc) times with respect to the basic pitch. In this case, if we assume values for Nc and Dc like those given above, we will obtain a 1/2 the basic pitch or a sine wave of multiple value. As long as the value for De is not 0, the output will indicate a pitch sine wave slightly offset from 1/2 the basic pitch or multiple value. When B(t) is greater than 0, the output will not be a sine wave but a wave form including a high harmonic component, because B(t) * sin (Nm + Dm) * wt is added onto the (Nc + Dc) * wt phase information. It therefore follows that a variety of wave forms including a high harmonic component can be obtained by selecting different values for B(t) and (Nm + Dm). Also, the timbre can be altered and output by temporal adjustment of B(t).

The YM2151 is equipped to handle 7 different kinds of combinatory connection methods. with two circuits composed of this basic structure assigned to a single note, which can be arranged serially or in parallel, or made to act as only a sine- wave sound source. In addition, with the unit set up as in Figure 1.10, with inclusion of a circuit that takes one's own output signal and returns it to oneself, virtually any type of wave form can be obtained via proper adjustment

## Accessing

Addresses 0x1810 and 0x1811 are used to control the YM2151 sound chip. The YM2151 has two registers: one for selecting the register to write to (0x1810), and one for writing the data to that register (0x1811).

### Global Registers

* 0x00: unused
* 0x01: Test
* 0x08: Slot number (bits D3 - D6), channel number (bits D0 - D2)
* 0x0f: Noise enable (bit D7), Noise frequency (bits D0 - D4)
* 0x10: Clock A1 (bits D0 - D7)
* 0x11: Clock A2 (bits D0 - D1)
* 0x12: Clock B (bits D0 - D7)
* 0x14: CSM (bit D7), FReset (bits D4 - D5), IRQEN (bits D2 - D3), LOAD (D0 - D1)
* 0x18: LFRQ (bits D0 - D7)
* 0x19: AMD/PMD (bits D0 - D7)
* 0x1b: MHz (bits D6 - D7), LFO Wave (bits D0 - D1; saw, square, tri, noise)

### Per-channel Registers

These registers come in groups of 8, which correspond to channels 0 to 7:

* 0x20 - 0x27: Right channel enable (bit D7), Left channel enable (bit D6), Feedback level (bits D3 - D5), Connection algorithm (bits D0 - D2)
* 0x28 - 0x2f: Octave (D4 - D6), Note (D0 - D3)
* 0x30 - 0x37: Key Fraction (D7 - D3)
* 0x40 - 0x47: (OP1) Detune 1 (D4 - D7), Multiply (D0 - D3)
* 0x48 - 0x4f: (OP3) Detune 1 (D4 - D7), Multiply (D0 - D3)
* 0x50 - 0x57: (OP2) Detune 1 (D4 - D7), Multiply (D0 - D3)
* 0x58 - 0x5f: (OP4) Detune 1 (D4 - D7), Multiply (D0 - D3)
* 0x60 - 0x67: (OP1) Total Level/volume (D0 - D6)
* 0x68 - 0x6f: (OP3) Total Level/volume (D0 - D6)
* 0x70 - 0x77: (OP2) Total Level/volume (D0 - D6)
* 0x78 - 0x7f: (OP4) Total Level/volume (D0 - D6)
* 0x80 - 0x87: (OP1) Keyscale (D6 - D7), Attack (D0 - D4)
* 0x88 - 0x8f: (OP3) Keyscale (D6 - D7), Attack (D0 - D4)
* 0x90 - 0x97: (OP2) Keyscale (D6 - D7), Attack (D0 - D4)
* 0x98 - 0x9f: (OP4) Keyscale (D6 - D7), Attack (D0 - D4)
* 0xa0 - 0xa7: (OP1) AMS enable (D7), Decay D1R (D0 - D4)
* 0xa8 - 0xaf: (OP3) AMS enable (D7), Decay D1R (D0 - D4)
* 0xb0 - 0xb7: (OP2) AMS enable (D7), Decay D1R (D0 - D4)
* 0xb8 - 0xbf: (OP4) AMS enable (D7), Decay D1R (D0 - D4)
* 0xc0 - 0xc7: (OP1) Detune dT2 (D6 - D7), Decay D2R (D0 - D4)
* 0xc8 - 0xcf: (OP3) Detune dT2 (D6 - D7), Decay D2R (D0 - D4)
* 0xd0 - 0xd7: (OP2) Detune dT2 (D6 - D7), Decay D2R (D0 - D4)
* 0xd8 - 0xdf: (OP4) Detune dT2 (D6 - D7), Decay D2R (D0 - D4)
* 0xe0 - 0xe7: (OP1) Decay D1L (D4 - D7), Release Rate (D0 - D3)
* 0xe8 - 0xef: (OP3) Decay D1L (D4 - D7), Release Rate (D0 - D3)
* 0xf0 - 0xf7: (OP2) Decay D1L (D4 - D7), Release Rate (D0 - D3)
* 0xf8 - 0xff: (OP4) Decay D1L (D4 - D7), Release Rate (D0 - D3)
